

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>sim_twfe_network module &mdash; pytwoway 0.0.3 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> pytwoway
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc-cli.html">From terminal</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc-python.html">From python</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notebooks/pytwoway_example.html">Simple</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/monte_carlo_example.html">Monte Carlo</a></li>
</ul>
<p class="caption"><span class="caption-text">Under the hood</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="internal.html">Python API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pytwoway</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>sim_twfe_network module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/sim_twfe_network.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="module-pytwoway.sim_twfe_network">
<span id="sim-twfe-network-module"></span><h1>sim_twfe_network module<a class="headerlink" href="#module-pytwoway.sim_twfe_network" title="Permalink to this headline">¶</a></h1>
<p>Class for a simulated two-way fixed effect network</p>
<dl class="py class">
<dt id="pytwoway.sim_twfe_network.SimTwoWay">
<em class="property">class </em><code class="sig-prename descclassname">pytwoway.sim_twfe_network.</code><code class="sig-name descname">SimTwoWay</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sim_params</span><span class="o">=</span><span class="default_value">{}</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pytwoway.sim_twfe_network.SimTwoWay" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Class of SimTwoWay, where SimTwoWay simulates a network of firms and workers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sim_params</strong> (<em>dict</em>) – <p>parameters for simulated data</p>
<p>Dictionary parameters:</p>
<blockquote>
<div><p>num_ind (int): number of workers</p>
<p>num_time (int): time length of panel</p>
<p>firm_size (int): max number of individuals per firm</p>
<p>nk (int): number of firm types</p>
<p>nl (int): number of worker types</p>
<p>alpha_sig (float): standard error of individual fixed effect (volatility of worker effects)</p>
<p>psi_sig (float): standard error of firm fixed effect (volatility of firm effects)</p>
<p>w_sig (float): standard error of residual in AKM wage equation (volatility of wage shocks)</p>
<p>csort (float): sorting effect</p>
<p>cnetw (float): network effect</p>
<p>csig (float): standard error of sorting/network effects</p>
<p>p_move (float): probability a worker moves firms in any period</p>
</div></blockquote>
</p>
</dd>
</dl>
<dl class="py method">
<dt id="pytwoway.sim_twfe_network.SimTwoWay.sim_network">
<code class="sig-name descname">sim_network</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pytwoway.sim_twfe_network.SimTwoWay.sim_network" title="Permalink to this definition">¶</a></dt>
<dd><p>Simulate panel data corresponding to the calibrated model.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>simulated network</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>data (Pandas DataFrame)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pytwoway.sim_twfe_network.SimTwoWay.sim_network_draw_fids">
<code class="sig-name descname">sim_network_draw_fids</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">freq</span></em>, <em class="sig-param"><span class="n">num_time</span></em>, <em class="sig-param"><span class="n">firm_size</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pytwoway.sim_twfe_network.SimTwoWay.sim_network_draw_fids" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw firm ids for individual, given data that is grouped by worker id, spell id, and firm type.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>freq</strong> (<em>NumPy Array</em>) – size of groups (groups by worker id, spell id, and firm type)</p></li>
<li><p><strong>num_time</strong> (<em>int</em>) – time length of panel</p></li>
<li><p><strong>firm_size</strong> (<em>int</em>) – max number of individuals per firm</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>random firms for each group</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>(NumPy Array)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pytwoway.sim_twfe_network.SimTwoWay.sim_network_gen_fe">
<code class="sig-name descname">sim_network_gen_fe</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sim_params</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pytwoway.sim_twfe_network.SimTwoWay.sim_network_gen_fe" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate fixed effects values for simulated panel data corresponding to the calibrated model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sim_params</strong> (<em>dict</em>) – <p>parameters for simulated data</p>
<p>Dictionary parameters:</p>
<blockquote>
<div><p>num_ind (int): number of workers</p>
<p>num_time (int): time length of panel</p>
<p>firm_size (int): max number of individuals per firm</p>
<p>nk (int): number of firm types</p>
<p>nl (int): number of worker types</p>
<p>alpha_sig (float): standard error of individual fixed effect (volatility of worker effects)</p>
<p>psi_sig (float): standard error of firm fixed effect (volatility of firm effects)</p>
<p>w_sig (float): standard error of residual in AKM wage equation (volatility of wage shocks)</p>
<p>csort (float): sorting effect</p>
<p>cnetw (float): network effect</p>
<p>csig (float): standard error of sorting/network effects</p>
<p>p_move (float): probability a worker moves firms in any period</p>
</div></blockquote>
</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>array of firm fixed effects
alpha (NumPy Array): array of individual fixed effects
G (NumPy Array): transition matrices
H (NumPy Array): stationary distribution</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>psi (NumPy Array)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pytwoway.sim_twfe_network.SimTwoWay.update_dict">
<code class="sig-name descname">update_dict</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">default_params</span></em>, <em class="sig-param"><span class="n">user_params</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pytwoway.sim_twfe_network.SimTwoWay.update_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Replace entries in default_params with values in user_params. This function allows user_params to include only a subset of the required parameters in the dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>default_params</strong> (<em>dict</em>) – default parameter values</p></li>
<li><p><strong>user_params</strong> (<em>dict</em>) – user selected parameter values</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>default_params updated with parameter values in user_params</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>params (dict)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="pytwoway.sim_twfe_network.TwoWayMonteCarlo">
<em class="property">class </em><code class="sig-prename descclassname">pytwoway.sim_twfe_network.</code><code class="sig-name descname">TwoWayMonteCarlo</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sim_params</span><span class="o">=</span><span class="default_value">{}</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pytwoway.sim_twfe_network.TwoWayMonteCarlo" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Class of TwoWayMonteCarlo, where TwoWayMonteCarlo runs a Monte Carlo estimate by simulating networks of firms and workers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sim_params</strong> (<em>dict</em>) – <p>parameters for simulated data</p>
<p>Dictionary parameters:</p>
<blockquote>
<div><p>num_ind (int): number of workers</p>
<p>num_time (int): time length of panel</p>
<p>firm_size (int): max number of individuals per firm</p>
<p>nk (int): number of firm types</p>
<p>nl (int): number of worker types</p>
<p>alpha_sig (float): standard error of individual fixed effect (volatility of worker effects)</p>
<p>psi_sig (float): standard error of firm fixed effect (volatility of firm effects)</p>
<p>w_sig (float): standard error of residual in AKM wage equation (volatility of wage shocks)</p>
<p>csort (float): sorting effect</p>
<p>cnetw (float): network effect</p>
<p>csig (float): standard error of sorting/network effects</p>
<p>p_move (float): probability a worker moves firms in any period</p>
</div></blockquote>
</p>
</dd>
</dl>
<dl class="py method">
<dt id="pytwoway.sim_twfe_network.TwoWayMonteCarlo.plot_monte_carlo">
<code class="sig-name descname">plot_monte_carlo</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pytwoway.sim_twfe_network.TwoWayMonteCarlo.plot_monte_carlo" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot results from Monte Carlo simulations.</p>
</dd></dl>

<dl class="py method">
<dt id="pytwoway.sim_twfe_network.TwoWayMonteCarlo.twfe_monte_carlo">
<code class="sig-name descname">twfe_monte_carlo</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">N</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">ncore</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">fe_params</span><span class="o">=</span><span class="default_value">{}</span></em>, <em class="sig-param"><span class="n">cre_params</span><span class="o">=</span><span class="default_value">{}</span></em>, <em class="sig-param"><span class="n">cluster_params</span><span class="o">=</span><span class="default_value">{}</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pytwoway.sim_twfe_network.TwoWayMonteCarlo.twfe_monte_carlo" title="Permalink to this definition">¶</a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>Run Monte Carlo simulations of TwoWay to see the distribution of the true vs. estimated variance of psi and covariance between psi and alpha. Saves the following results in the dictionary self.res:</p>
<blockquote>
<div><p>true_psi_var (NumPy Array): true simulated sample variance of psi</p>
<p>true_psi_alpha_cov (NumPy Array): true simulated sample covariance of psi and alpha</p>
<p>fe_psi_var (NumPy Array): AKM estimate of variance of psi</p>
<p>fe_psi_alpha_cov (NumPy Array): AKM estimate of covariance of psi and alpha</p>
<p>fe_corr_psi_var (NumPy Array): bias-corrected AKM estimate of variance of psi</p>
<p>fe_corr_psi_alpha_cov (NumPy Array): bias-corrected AKM estimate of covariance of psi and alpha</p>
<p>cre_psi_var (NumPy Array): CRE estimate of variance of psi</p>
<p>cre_psi_alpha_cov (NumPy Array): CRE estimate of covariance of psi and alpha</p>
</div></blockquote>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>N</strong> (<em>int</em>) – number of simulations</p></li>
<li><p><strong>ncore</strong> (<em>int</em>) – how many cores to use</p></li>
<li><p><strong>fe_params</strong> (<em>dict</em>) – <p>dictionary of parameters for FE estimation</p>
<p>Dictionary parameters:</p>
<blockquote>
<div><p>ncore (int): number of cores to use</p>
<p>batch (int): batch size to send in parallel</p>
<p>ndraw_pii (int): number of draw to use in approximation for leverages</p>
<p>ndraw_tr (int): number of draws to use in approximation for traces</p>
<p>check (bool): whether to compute the non-approximated estimates as well</p>
<p>hetero (bool): whether to compute the heteroskedastic estimates</p>
<p>out (string): outputfile</p>
<p>con (string): computes the smallest eigen values, this is the filepath where these results are saved</p>
<p>logfile (string): log output to a logfile</p>
<p>levfile (string): file to load precomputed leverages</p>
<p>statsonly (bool): save data statistics only</p>
</div></blockquote>
</p></li>
<li><p><strong>cre_params</strong> (<em>dict</em>) – <p>dictionary of parameters for CRE estimation</p>
<p>Dictionary parameters:</p>
<blockquote>
<div><p>ncore (int): number of cores to use</p>
<p>ndraw_tr (int): number of draws to use in approximation for traces</p>
<p>ndp (int): number of draw to use in approximation for leverages</p>
<p>out (string): outputfile</p>
<p>posterior (bool): compute posterior variance</p>
<p>wo_btw (bool): sets between variation to 0, pure RE</p>
</div></blockquote>
</p></li>
<li><p><strong>cluster_params</strong> (<em>dict</em>) – <p>dictionary of parameters for clustering in CRE estimation</p>
<p>Dictionary parameters:</p>
<blockquote>
<div><p>cdf_resolution (int): how many values to use to approximate the cdf</p>
<p>grouping (string): how to group the cdfs (‘quantile_all’ to get quantiles from entire set of data, then have firm-level values between 0 and 1; ‘quantile_firm_small’ to get quantiles at the firm-level and have values be compensations if small data; ‘quantile_firm_large’ to get quantiles at the firm-level and have values be compensations if large data, note that this is up to 50 times slower than ‘quantile_firm_small’ and should only be used if the dataset is too large to copy into a dictionary)</p>
<p>year (int): if None, uses entire dataset; if int, gives year of data to consider</p>
<p>KMeans_params (dict): use parameters defined in KMeans_dict for KMeans estimation (for more information on what parameters can be used, visit <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html">https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html</a>), and use default parameters defined in class attribute default_KMeans for any parameters not specified</p>
</div></blockquote>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pytwoway.sim_twfe_network.TwoWayMonteCarlo.twfe_monte_carlo_interior">
<code class="sig-name descname">twfe_monte_carlo_interior</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fe_params</span><span class="o">=</span><span class="default_value">{}</span></em>, <em class="sig-param"><span class="n">cre_params</span><span class="o">=</span><span class="default_value">{}</span></em>, <em class="sig-param"><span class="n">cluster_params</span><span class="o">=</span><span class="default_value">{}</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pytwoway.sim_twfe_network.TwoWayMonteCarlo.twfe_monte_carlo_interior" title="Permalink to this definition">¶</a></dt>
<dd><p>Run Monte Carlo simulations of TwoWay to see the distribution of the true vs. estimated variance of psi and covariance between psi and alpha. This is the interior function to twfe_monte_carlo.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fe_params</strong> (<em>dict</em>) – <p>dictionary of parameters for FE estimation</p>
<p>Dictionary parameters:</p>
<blockquote>
<div><p>ncore (int): number of cores to use</p>
<p>batch (int): batch size to send in parallel</p>
<p>ndraw_pii (int): number of draw to use in approximation for leverages</p>
<p>ndraw_tr (int): number of draws to use in approximation for traces</p>
<p>check (bool): whether to compute the non-approximated estimates as well</p>
<p>hetero (bool): whether to compute the heteroskedastic estimates</p>
<p>out (string): outputfile</p>
<p>con (string): computes the smallest eigen values, this is the filepath where these results are saved</p>
<p>logfile (string): log output to a logfile</p>
<p>levfile (string): file to load precomputed leverages</p>
<p>statsonly (bool): save data statistics only</p>
</div></blockquote>
</p></li>
<li><p><strong>cre_params</strong> (<em>dict</em>) – <p>dictionary of parameters for CRE estimation</p>
<p>Dictionary parameters:</p>
<blockquote>
<div><p>ncore (int): number of cores to use</p>
<p>ndraw_tr (int): number of draws to use in approximation for traces</p>
<p>ndp (int): number of draw to use in approximation for leverages</p>
<p>out (string): outputfile</p>
<p>posterior (bool): compute posterior variance</p>
<p>wo_btw (bool): sets between variation to 0, pure RE</p>
</div></blockquote>
</p></li>
<li><p><strong>cluster_params</strong> (<em>dict</em>) – <p>dictionary of parameters for clustering in CRE estimation</p>
<p>Dictionary parameters:</p>
<blockquote>
<div><p>cdf_resolution (int): how many values to use to approximate the cdf
grouping (string): how to group the cdfs (‘quantile_all’ to get quantiles from entire set of data, then have firm-level values between 0 and 1; ‘quantile_firm_small’ to get quantiles at the firm-level and have values be compensations if small data; ‘quantile_firm_large’ to get quantiles at the firm-level and have values be compensations if large data, note that this is up to 50 times slower than ‘quantile_firm_small’ and should only be used if the dataset is too large to copy into a dictionary)</p>
<p>year (int): if None, uses entire dataset; if int, gives year of data to consider</p>
<p>KMeans_params (dict): use parameters defined in KMeans_dict for KMeans estimation (for more information on what parameters can be used, visit <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html">https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html</a>), and use default parameters defined in class attribute default_KMeans for any parameters not specified</p>
</div></blockquote>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>true simulated sample variance of psi
true_psi_alpha_cov (float): true simulated sample covariance of psi and alpha
fe_psi_var (float): AKM estimate of variance of psi
fe_psi_alpha_cov (float): AKM estimate of covariance of psi and alpha
fe_corr_psi_var (float): bias-corrected AKM estimate of variance of psi
fe_corr_psi_alpha_cov (float): bias-corrected AKM estimate of covariance of psi and alpha
cre_psi_var (float): CRE estimate of variance of psi
cre_psi_alpha_cov (float): CRE estimate of covariance of psi and alpha</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>true_psi_var (float)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Thibaut Lamadon
      <span class="lastupdated">
        Last updated on Jan 05, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>