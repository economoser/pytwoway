

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>BLM example &mdash; pytwoway 0.0.3 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> pytwoway
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-cli.html">From terminal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-python.html">From python</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pytwoway_example.html">Simple</a></li>
<li class="toctree-l1"><a class="reference internal" href="monte_carlo_example.html">Monte Carlo</a></li>
</ul>
<p class="caption"><span class="caption-text">Under the hood</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../internal.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../class-twoway.html">TwoWay</a></li>
<li class="toctree-l1"><a class="reference internal" href="../class-cresolver.html">CRESolver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../class-fesolver.html">FESolver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../class-bipartitedata.html">BipartiteData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../class-simtwoway.html">SimTwoWay</a></li>
<li class="toctree-l1"><a class="reference internal" href="../class-twowaymontecarlo.html">TwoWayMonteCarlo</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pytwoway</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>BLM example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/notebooks/blm_example.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="BLM-example">
<h1>BLM example<a class="headerlink" href="#BLM-example" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Add pytwoway to system path, do not run this</span>
<span class="c1"># import sys</span>
<span class="c1"># sys.path.append(&#39;../../..&#39;)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Import the pytwoway package</span>
<span class="c1"># (Make sure you have installed it using pip install pytwoway)</span>
<span class="kn">import</span> <span class="nn">pytwoway</span> <span class="k">as</span> <span class="nn">tw</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
<div class="section" id="Simulate-some-data">
<h2>Simulate some data<a class="headerlink" href="#Simulate-some-data" title="Permalink to this headline">¶</a></h2>
<p>The package contains functions to simulate data. We use this here to keep things simple. If you have your own data, you can import it. Load it as a pandas dataframe and use it as an input.</p>
<p>As you can see, we will need the following required columns in our data:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">wid</span></code>: the worker identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fid</span></code>: the firm identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">year</span></code>: the time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">comp</span></code>: the outcome variable, in our case compensation</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># For the example, we simulate data</span>
<span class="n">sim_data</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">SimTwoWay</span><span class="p">()</span><span class="o">.</span><span class="n">sim_network</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">sim_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wid</th>
      <th>year</th>
      <th>k</th>
      <th>alpha</th>
      <th>psi</th>
      <th>spell</th>
      <th>freq</th>
      <th>fid</th>
      <th>move</th>
      <th>comp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>-0.430727</td>
      <td>-0.348756</td>
      <td>1</td>
      <td>2</td>
      <td>61</td>
      <td>False</td>
      <td>-0.039403</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>-0.430727</td>
      <td>-0.348756</td>
      <td>1</td>
      <td>2</td>
      <td>61</td>
      <td>False</td>
      <td>0.191977</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>3</td>
      <td>4</td>
      <td>-0.430727</td>
      <td>-0.114185</td>
      <td>2</td>
      <td>1</td>
      <td>65</td>
      <td>True</td>
      <td>0.921665</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>4</td>
      <td>4</td>
      <td>-0.430727</td>
      <td>-0.114185</td>
      <td>3</td>
      <td>2</td>
      <td>80</td>
      <td>True</td>
      <td>0.438901</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>5</td>
      <td>4</td>
      <td>-0.430727</td>
      <td>-0.114185</td>
      <td>3</td>
      <td>2</td>
      <td>80</td>
      <td>False</td>
      <td>-1.845248</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>49995</th>
      <td>10000</td>
      <td>1</td>
      <td>8</td>
      <td>0.967422</td>
      <td>0.908458</td>
      <td>1</td>
      <td>5</td>
      <td>160</td>
      <td>False</td>
      <td>0.733515</td>
    </tr>
    <tr>
      <th>49996</th>
      <td>10000</td>
      <td>2</td>
      <td>8</td>
      <td>0.967422</td>
      <td>0.908458</td>
      <td>1</td>
      <td>5</td>
      <td>160</td>
      <td>False</td>
      <td>-1.197897</td>
    </tr>
    <tr>
      <th>49997</th>
      <td>10000</td>
      <td>3</td>
      <td>8</td>
      <td>0.967422</td>
      <td>0.908458</td>
      <td>1</td>
      <td>5</td>
      <td>160</td>
      <td>False</td>
      <td>2.218761</td>
    </tr>
    <tr>
      <th>49998</th>
      <td>10000</td>
      <td>4</td>
      <td>8</td>
      <td>0.967422</td>
      <td>0.908458</td>
      <td>1</td>
      <td>5</td>
      <td>160</td>
      <td>False</td>
      <td>1.925685</td>
    </tr>
    <tr>
      <th>49999</th>
      <td>10000</td>
      <td>5</td>
      <td>8</td>
      <td>0.967422</td>
      <td>0.908458</td>
      <td>1</td>
      <td>5</td>
      <td>160</td>
      <td>False</td>
      <td>2.612456</td>
    </tr>
  </tbody>
</table>
<p>50000 rows × 10 columns</p>
</div></div>
</div>
</div>
<div class="section" id="Create-a-BipartiteData-object-using-your-data">
<h2>Create a BipartiteData object using your data<a class="headerlink" href="#Create-a-BipartiteData-object-using-your-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># We need to specify a column dictionary to make sure columns are named correctly</span>
<span class="c1"># You can also manually update column names yourself</span>
<span class="n">col_name_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fid&#39;</span><span class="p">:</span> <span class="s1">&#39;fid&#39;</span><span class="p">,</span>    <span class="c1"># Specify the column name for the firm identifier</span>
    <span class="s1">&#39;wid&#39;</span><span class="p">:</span> <span class="s1">&#39;wid&#39;</span><span class="p">,</span>    <span class="c1"># Specify the column name for the worker identifier</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span>  <span class="c1"># Specify the column name for the year</span>
    <span class="s1">&#39;comp&#39;</span><span class="p">:</span> <span class="s1">&#39;comp&#39;</span>   <span class="c1"># Specify the column name for the outcome variable</span>
<span class="p">}</span>

<span class="c1"># Create the BipartiteData object to prepare your data</span>
<span class="n">b_net</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">BipartiteData</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">sim_data</span><span class="p">,</span> <span class="n">col_dict</span><span class="o">=</span><span class="n">col_name_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Clean-your-data">
<h1>Clean your data<a class="headerlink" href="#Clean-your-data" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Set nk, the number of firm types you would like</span>
<span class="n">nk</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1">## Optional Parameters ##</span>
<span class="n">KMeans_params</span> <span class="o">=</span> <span class="p">{</span> <span class="c1"># These parameters are specifically for the KMeans algorithm</span>
                  <span class="c1"># Read more at https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html</span>
    <span class="s1">&#39;n_clusters&#39;</span><span class="p">:</span> <span class="n">nk</span><span class="p">,</span>
    <span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="s1">&#39;k-means++&#39;</span><span class="p">,</span>
    <span class="s1">&#39;n_init&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
    <span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
    <span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="mf">0.0001</span><span class="p">,</span>
    <span class="s1">&#39;precompute_distances&#39;</span><span class="p">:</span> <span class="s1">&#39;deprecated&#39;</span><span class="p">,</span>
    <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;copy_x&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;n_jobs&#39;</span><span class="p">:</span> <span class="s1">&#39;deprecated&#39;</span><span class="p">,</span>
    <span class="s1">&#39;algorithm&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span>
<span class="p">}</span>
<span class="n">cluster_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cdf_resolution&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="c1"># How many values to use to approximate the cdf when clustering</span>
    <span class="s1">&#39;grouping&#39;</span><span class="p">:</span> <span class="s1">&#39;quantile_all&#39;</span><span class="p">,</span>
        <span class="c1"># How to group the cdfs when clustering</span>
        <span class="c1"># (&#39;quantile_all&#39; to get quantiles from entire set of data,</span>
        <span class="c1">#     then have firm-level values between 0 and 1;</span>
        <span class="c1"># &#39;quantile_firm_small&#39; to get quantiles at the firm-level</span>
        <span class="c1">#     and have values be compensations if small data;</span>
        <span class="c1"># &#39;quantile_firm_large&#39; to get quantiles at the firm-level</span>
        <span class="c1">#     and have values be compensations if large data,</span>
        <span class="c1">#     note that this is up to 50 times slower than &#39;quantile_firm_small&#39;</span>
        <span class="c1">#     and should only be used if the dataset is too large to copy</span>
        <span class="c1">#     into a dictionary)</span>
    <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># If None, uses entire dataset when clustering;</span>
                  <span class="c1"># If int, gives year of data to consider when clustering</span>
    <span class="s1">&#39;user_KMeans&#39;</span><span class="p">:</span> <span class="n">KMeans_params</span>
<span class="p">}</span>

<span class="c1"># Prepare data</span>
<span class="n">b_net</span><span class="o">.</span><span class="n">clean_data</span><span class="p">()</span>
<span class="n">b_net</span><span class="o">.</span><span class="n">long_to_es</span><span class="p">()</span>
<span class="c1"># Cluster data</span>
<span class="n">b_net</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">user_cluster</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;user_KMeans&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;n_clusters&#39;</span><span class="p">:</span> <span class="n">nk</span><span class="p">}})</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Extract-jdata-and-sdata-from-your-BipartiteData">
<h1>Extract jdata and sdata from your BipartiteData<a class="headerlink" href="#Extract-jdata-and-sdata-from-your-BipartiteData" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Get cross section</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">b_net</span><span class="o">.</span><span class="n">get_cs</span><span class="p">()</span>
<span class="c1"># Fix j1 and j2 to start at 0</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">chained_assignment</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">cs</span><span class="p">[</span><span class="s1">&#39;j1&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="n">cs</span><span class="p">[</span><span class="s1">&#39;j2&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">chained_assignment</span> <span class="o">=</span> <span class="s1">&#39;warn&#39;</span>
<span class="c1"># Get jdata and sdata</span>
<span class="n">jdata</span> <span class="o">=</span> <span class="n">cs</span><span class="p">[(</span><span class="n">cs</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cs</span><span class="p">[</span><span class="s1">&#39;cs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
<span class="n">sdata</span> <span class="o">=</span> <span class="n">cs</span><span class="p">[(</span><span class="n">cs</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cs</span><span class="p">[</span><span class="s1">&#39;cs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Initialize-and-run-BLMEstimator">
<h1>Initialize and run BLMEstimator<a class="headerlink" href="#Initialize-and-run-BLMEstimator" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Set nl, the number of worker types you would like</span>
<span class="n">nl</span> <span class="o">=</span> <span class="mi">6</span>
<span class="c1">## Optional Parameters ##</span>
<span class="n">BLM_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;nl&#39;</span><span class="p">:</span> <span class="n">nl</span><span class="p">,</span> <span class="c1"># Number of worker types</span>
    <span class="s1">&#39;nk&#39;</span><span class="p">:</span> <span class="n">nk</span><span class="p">,</span> <span class="c1"># Number of firm types</span>
    <span class="s1">&#39;fixb&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># Set A2 = np.mean(A2, axis=0) + A1 - np.mean(A1, axis=0)</span>
    <span class="s1">&#39;stationary&#39;</span><span class="p">:</span> <span class="kc">False</span> <span class="c1"># Set A1 = A2</span>
<span class="p">}</span>
<span class="n">fit_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;maxiter&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="c1"># Max number of iterations</span>
    <span class="s1">&#39;update_a&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="c1"># If False, don&#39;t update A1 or A2</span>
    <span class="s1">&#39;update_s&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="c1"># If False, don&#39;t update S1 or S2</span>
    <span class="s1">&#39;return_qi&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># If True, return first qi matrix</span>
    <span class="s1">&#39;cons_a&#39;</span><span class="p">:</span> <span class="p">([</span><span class="s1">&#39;lin&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;n_periods&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}),</span> <span class="c1"># Constraints on A</span>
    <span class="s1">&#39;cons_s&#39;</span><span class="p">:</span> <span class="p">([</span><span class="s1">&#39;biggerthan&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;gap_bigger&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;n_periods&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span> <span class="c1"># Constraints on S</span>
<span class="p">}</span>
<span class="c1"># Initialize BLM estimator</span>
<span class="n">BLM</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">BLMEstimator</span><span class="p">(</span><span class="n">BLM_params</span><span class="p">)</span>
<span class="c1"># Run BLM estimator</span>
<span class="n">BLM</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">jdata</span><span class="o">=</span><span class="n">jdata</span><span class="p">,</span> <span class="n">sdata</span><span class="o">=</span><span class="n">sdata</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ncore</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_fit</span><span class="o">=</span><span class="n">fit_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Running constrained movers
Generating parameters
loop 0, liks 30.218359375057076
loop 1, liks 67.3989586190527
loop 2, liks 67.40635063263085
loop 3, liks 67.4165405679269
loop 4, liks 67.42917888156046
Running unconstrained movers
Using given parameters
loop 0, liks 67.44411776363494
loop 1, liks 67.46188459719222
loop 2, liks 67.47998545242893
loop 3, liks 67.49683220552113
loop 4, liks 67.51169994867115
Running constrained movers
Generating parameters
loop 0, liks 30.270691839232825
loop 1, liks 67.39190524516901
loop 2, liks 67.40120256264245
loop 3, liks 67.41396130267192
loop 4, liks 67.42973692694575
Running unconstrained movers
Using given parameters
loop 0, liks 67.44749940943852
loop 1, liks 67.46851469200482
loop 2, liks 67.48629045819018
loop 3, liks 67.50145698502727
loop 4, liks 67.5141260053384
Running constrained movers
Generating parameters
loop 0, liks 30.41503883631233
loop 1, liks 67.39066041617879
loop 2, liks 67.39658443187582
loop 3, liks 67.40329713475991
loop 4, liks 67.4121743579305
Running unconstrained movers
Using given parameters
loop 0, liks 67.42390943144498
loop 1, liks 67.44024039248646
loop 2, liks 67.45781919769426
loop 3, liks 67.4756296209491
loop 4, liks 67.4917933848534
Running constrained movers
Generating parameters
loop 0, liks 30.384971391500798
loop 1, liks 67.38821704646213
loop 2, liks 67.39126108577585
loop 3, liks 67.39590827315114
loop 4, liks 67.40143462150084
Running unconstrained movers
Using given parameters
loop 0, liks 67.40867188591092
loop 1, liks 67.41847764502313
loop 2, liks 67.43084750792877
loop 3, liks 67.44480210680805
loop 4, liks 67.45900571304861
Running constrained movers
Generating parameters
loop 0, liks 30.14403055538926
loop 1, liks 67.36606379588274
loop 2, liks 67.37937999571217
loop 3, liks 67.39248749388987
loop 4, liks 67.40831436198127
Running unconstrained movers
Using given parameters
loop 0, liks 67.42586126825033
loop 1, liks 67.4439144026178
loop 2, liks 67.46159413294457
loop 3, liks 67.47689361453845
loop 4, liks 67.48955708460322
Running constrained movers
Generating parameters
loop 0, liks 30.42935999143949
loop 1, liks 67.41462500626142
loop 2, liks 67.43060064801864
loop 3, liks 67.447214870166
loop 4, liks 67.46432063963516
Running unconstrained movers
Using given parameters
loop 0, liks 67.48005932036426
loop 1, liks 67.49671236915358
loop 2, liks 67.50743603489005
loop 3, liks 67.51472974447738
loop 4, liks 67.51966966909107
Running constrained movers
Generating parameters
loop 0, liks 30.345856898709624
loop 1, liks 67.37963464166396
loop 2, liks 67.38983889770321
loop 3, liks 67.40201295121474
loop 4, liks 67.41751750679913
Running unconstrained movers
Using given parameters
loop 0, liks 67.43609473267108
loop 1, liks 67.4574063096945
loop 2, liks 67.47933123767022
loop 3, liks 67.50043489228041
loop 4, liks 67.51988226201763
Running constrained movers
Generating parameters
loop 0, liks 30.322511835783686
loop 1, liks 67.39605492421794
loop 2, liks 67.4010619637916
loop 3, liks 67.40927363365128
loop 4, liks 67.41909307205795
Running unconstrained movers
Using given parameters
loop 0, liks 67.42961148673848
loop 1, liks 67.44351954630089
loop 2, liks 67.45339767257042
loop 3, liks 67.45992368245425
loop 4, liks 67.46320863148364
Running constrained movers
Generating parameters
loop 0, liks 30.145969846237428
loop 1, liks 67.36721043021075
loop 2, liks 67.36949770019656
loop 3, liks 67.37164748660443
loop 4, liks 67.37461986442639
Running unconstrained movers
Using given parameters
loop 0, liks 67.37896733754427
loop 1, liks 67.38569093831765
loop 2, liks 67.39422752744163
loop 3, liks 67.40519842909741
loop 4, liks 67.41845262661221
Running constrained movers
Generating parameters
loop 0, liks 30.3536937277648
loop 1, liks 67.38513834329873
loop 2, liks 67.39230104127397
loop 3, liks 67.4010299462476
loop 4, liks 67.41256102448237
Running unconstrained movers
Using given parameters
loop 0, liks 67.42742585111876
loop 1, liks 67.44610936862753
loop 2, liks 67.46664227506113
loop 3, liks 67.48794301047762
loop 4, liks 67.50857603900073
max_liks: 67.51988226201763
Running stayers
loop 0, liks 21.169306648645016
loop 1, liks 46.14528018898912
loop 2, liks 46.153605817711686
loop 3, liks 46.15134158023668
loop 4, liks 46.14035526366938
</pre></div></div>
</div>
</div>
<div class="section" id="Finally,-we-can-investigate-the-results">
<h1>Finally, we can investigate the results<a class="headerlink" href="#Finally,-we-can-investigate-the-results" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A1:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">BLM</span><span class="o">.</span><span class="n">A1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A2:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">BLM</span><span class="o">.</span><span class="n">A2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;S1:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">BLM</span><span class="o">.</span><span class="n">S1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;S2:&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">BLM</span><span class="o">.</span><span class="n">S2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
A1:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[-0.53295763, -0.80978886, -0.49480033, -1.38011816, -1.074124  ,
        -0.79188372],
       [ 1.33914708,  1.0282124 ,  1.39437845,  0.22460559,  0.77387847,
         1.05412613],
       [ 0.40564531,  0.13171075,  0.61489814, -0.62809604, -0.17698568,
         0.19075934],
       [ 2.21835329,  1.92377594,  2.25336956,  1.12714919,  1.67101083,
         2.02885716],
       [ 0.70922378,  0.51254119,  0.8371937 , -0.33932867,  0.23627682,
         0.53441204],
       [-0.20092191, -0.27117599, -0.14825091, -1.11996037, -0.65793066,
        -0.28373386],
       [ 1.78127403,  1.38009708,  1.76242337,  0.57327071,  1.10053876,
         1.47259383],
       [ 0.21127129, -0.01618626,  0.33730459, -0.85955676, -0.34447407,
         0.01400774],
       [-0.7238159 , -1.26501781, -1.12080842, -1.97343547, -1.57032924,
        -1.22038656],
       [ 1.16471975,  0.76099611,  1.07140956, -0.08389307,  0.45454247,
         0.79296914]])
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
A2:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[-8.45395535e-01, -3.82848623e-01, -1.05799314e+00,
        -1.40078732e+00, -6.70535294e-01, -6.71232864e-01],
       [ 8.14685213e-01,  1.30137470e+00,  1.21940921e+00,
         1.65707945e-01,  1.08249987e+00,  1.17839090e+00],
       [ 3.90739812e-04,  2.78486620e-01,  6.63897485e-01,
        -6.70137534e-01, -1.15619362e-02,  2.73148305e-01],
       [ 2.07414170e+00,  1.81229887e+00,  2.27258932e+00,
         1.19196960e+00,  1.66166956e+00,  2.09410797e+00],
       [ 7.21989567e-01,  3.79517424e-01,  9.52448953e-01,
        -2.96745564e-01,  1.50909635e-01,  5.45438116e-01],
       [-1.47555903e-01, -5.25556654e-01,  3.59187555e-01,
        -1.02368094e+00, -9.07727687e-01, -5.02436691e-01],
       [ 1.97444354e+00,  1.19141712e+00,  1.75043433e+00,
         5.36156057e-01,  1.00283818e+00,  1.21055280e+00],
       [ 6.92447866e-01, -1.56341676e-02,  2.73156516e-01,
        -7.32676446e-01, -4.43080725e-01, -4.52986690e-01],
       [-1.43904909e-01, -1.25802341e+00, -9.03603733e-01,
        -1.69546106e+00, -1.57589397e+00, -8.72109583e-01],
       [ 1.53669062e+00,  6.89196721e-01,  1.08502394e+00,
         1.19373527e-01,  1.96002890e-01,  8.13301472e-01]])
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
S1:
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[1.1679172 , 0.80413269, 0.87375661, 0.74240759, 0.89447157,
        1.00076143],
       [0.94909727, 0.88398172, 0.86789392, 0.98305102, 0.93068299,
        0.93505749],
       [0.96944175, 0.89469752, 1.00412768, 0.86240097, 0.87201958,
        0.91920204],
       [0.9608749 , 0.94307186, 0.88373894, 0.87291135, 0.94045962,
        0.90787711],
       [0.8872984 , 0.85482774, 0.95192519, 0.89412739, 0.84707078,
        0.90528755],
       [1.12004615, 1.04739902, 0.93590677, 0.84920168, 0.91090938,
        0.99363943],
       [1.01073451, 0.92066133, 0.92009193, 0.91708267, 0.95253793,
        0.91836802],
       [0.9268142 , 0.92148819, 0.97385926, 0.87695215, 0.93486273,
        0.95605649],
       [1.0744111 , 0.90563456, 0.87571905, 0.87732243, 0.81690352,
        0.91164962],
       [1.00580484, 0.89553059, 0.79304674, 0.93129439, 0.80742514,
        0.83595328]])
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
S2:
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[0.93690686, 1.06381299, 0.81896065, 0.85201773, 0.97884109,
        0.92446184],
       [1.02902939, 0.91566569, 0.97821669, 0.83216162, 0.87879211,
        0.93677752],
       [0.82992163, 0.95698771, 0.98831419, 0.87319725, 0.90086339,
        0.95903818],
       [0.94969097, 0.90983187, 0.92293259, 0.96701386, 0.93271278,
        0.93979178],
       [0.90480257, 0.89026458, 0.89966509, 0.89251514, 0.90100503,
        0.89104362],
       [0.97888247, 0.88131896, 1.05441506, 0.89134181, 0.9067524 ,
        0.89017353],
       [0.87983762, 0.95188914, 0.8913769 , 0.8741808 , 0.94748445,
        0.95911894],
       [0.84283876, 0.91360155, 0.87424496, 0.85200397, 0.92883678,
        0.97410372],
       [0.73855666, 0.90138096, 0.952808  , 0.81924396, 1.01364679,
        0.93590071],
       [0.94372772, 0.85942538, 0.7461781 , 0.86611448, 0.93510599,
        0.82213238]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">BLM</span><span class="o">.</span><span class="n">plot_A1</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_blm_example_15_0.png" src="../_images/notebooks_blm_example_15_0.png" />
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Thibaut Lamadon.
      <span class="lastupdated">
        Last updated on Feb 23, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>